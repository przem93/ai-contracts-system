# Dockerfile for running tests in watch mode
# This is optimized for development and testing purposes only

FROM node:20-slim

WORKDIR /app

# Install dependencies for better terminal support
RUN apt-get update && apt-get install -y --no-install-recommends \
    tini \
    && rm -rf /var/lib/apt/lists/*

# Copy package files
COPY package*.json ./

# Install all dependencies (including devDependencies for testing)
RUN npm ci

# Copy necessary configuration files
COPY tsconfig.json ./
COPY nest-cli.json ./
COPY .eslintrc.js ./

# Copy source code (will be overridden by volume mount in development)
COPY src ./src

# Use tini to handle signals properly
ENTRYPOINT ["/usr/bin/tini", "--"]

# Default command (can be overridden in docker-compose.yml)
CMD ["npm", "run", "test:watch"]
